webpackJsonp([1],{"9M+g":function(e,t){},J2kO:function(e,t){},Ji9J:function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("7+uW"),r=a("//Fk"),o=a.n(r),s={computed:{isLoggedIn:function(){return this.$store.getters.isLoggedIn},hasUserParking:function(){return this.$store.getters.hasUserParking}},methods:{logout:function(){var e=this;this.$store.dispatch("logout").then(function(){e.$router.push("/login")})}},created:function(){this.$http.interceptors.response.use(void 0,function(e){return new o.a(function(t,a){throw 401===e.status&&e.config&&!e.config.__isRetryRequest&&this.$store.dispatch(logout),e})})}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{"xmlns:v-slot":"http://www.w3.org/1999/XSL/Transform"}},[a("b-navbar",{staticClass:"navbar-custom",attrs:{toggleable:"lg",type:"dark"}},[a("b-navbar-brand",{staticStyle:{"font-family":"Roboto","font-size":"25px"}},[e._v("CA parking app")]),e._v(" "),a("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),e._v(" "),a("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[a("b-navbar-nav",{staticStyle:{"font-family":"Roboto","font-size":"18px"}},[a("b-nav-item",[e.isLoggedIn?e._e():a("router-link",{staticClass:"nav-link",attrs:{to:"/login"}},[e._v("Zaloguj się")])],1),e._v(" "),a("b-nav-item",[e.isLoggedIn&&e.hasUserParking?a("router-link",{staticClass:"nav-link",attrs:{to:"/calendar"}},[e._v("Kalendarz")]):e._e()],1),e._v(" "),a("b-nav-item",[e.isLoggedIn&&!e.hasUserParking?a("router-link",{staticClass:"nav-link",attrs:{to:"/lottery"}},[e._v("Losowanie")]):e._e()],1),e._v(" "),a("b-nav-item",[e.isLoggedIn?a("span",{staticClass:"nav-link"},[a("a",{on:{click:e.logout}},[e._v("Wyloguj się")])]):e._e()])],1)],1)],1)],1)},staticRenderFns:[]};var c={name:"navbar",components:{Navbar:a("VU/8")(s,i,!1,function(e){a("ftB2")},null,null).exports}},u={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("Navbar"),this._v(" "),t("router-view",{attrs:{id:"middle"}})],1)},staticRenderFns:[]};var l=a("VU/8")(c,u,!1,function(e){a("P3JI")},null,null).exports,d=a("/ocq"),m=a("NYxO"),p=a("mtWM"),h=a.n(p);n.default.use(m.a);var f=new m.a.Store({state:{status:"",auth_token:localStorage.getItem("auth_token")||"",user:{}},mutations:{auth_request:function(e){e.status="loading"},auth_success:function(e,t,a){e.status="success",e.auth_token=t},auth_error:function(e){e.status="error"},logout:function(e){e.status="",e.auth_token=""}},actions:{login:function(e,t){var a=e.commit;return new o.a(function(e,n){a("auth_request"),h()({url:"https://calie-parking-backend.herokuapp.com/auth/login",data:t,method:"POST"}).then(function(t){var n=t.data.auth_token;localStorage.setItem("auth_token",n),h.a.defaults.headers.common.Authorization=n,a("auth_success",n),e(t)}).catch(function(e){a("auth_error"),localStorage.removeItem("auth_token"),n(e)})})},register:function(e,t){var a=e.commit;return new o.a(function(e,n){a("auth_request"),h()({url:"https://calie-parking-backend.herokuapp.com/auth/register",data:t,method:"POST"}).then(function(t){var n=t.data.auth_token;localStorage.setItem("auth_token",n),h.a.defaults.headers.common.Authorization=n,a("auth_success",n),e(t)}).catch(function(e){a("auth_error",e),localStorage.removeItem("auth_token"),n(e)})})},logout:function(e){var t=e.commit;return new o.a(function(e,a){t("logout"),localStorage.removeItem("auth_token"),delete h.a.defaults.headers.common.Authorization,e()})}},getters:{isLoggedIn:function(e){return!!e.auth_token},authStatus:function(e){return e.status},hasUserParking:function(e){return e.user.owned_parking_space}}}),g={data:function(){return{username:this.$store.state.user.username,name:this.$store.state.user.name}},watch:{getName:function(){return this.name.split(" ")[0]}},methods:{getUserStatus:function(){var e=this;h()({url:"https://calie-parking-backend.herokuapp.com/user/status",method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")}}).then(function(t){console.log("RESP_USER_STATUS"),e.$store.state.user=t.data,e.username=t.data.username,e.name=t.data.name,console.log(t.data.username)}).catch(function(e){console.log("ERR")})}},mounted:function(){this.getUserStatus()}},v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"main-page"}},[t("b-card",{staticClass:"border-top-0",staticStyle:{"background-image":"linear-gradient(#78EC6C, #57E86B)"}},[t("h1",{staticStyle:{color:"white"}},[this._v("Cześć  "+this._s(this.name.split(" ")[0]))]),this._v(" "),t("b",{staticStyle:{color:"white"}},[this._v("Na tej stronie możesz zwolnić miejsce parkingowe lub wylosować nowe")])])],1)},staticRenderFns:[]};var w=a("VU/8")(g,v,!1,function(e){a("hRX+")},null,null).exports,k={data:function(){return{form:{email:"",name:"",username:"",password:"",checked:[]},show:!0}},methods:{onSubmit:function(e){e.preventDefault(),this.register()},onReset:function(e){var t=this;e.preventDefault(),this.form.email="",this.form.name="",this.form.username="",this.form.password="",this.form.checked=[],this.show=!1,this.$nextTick(function(){t.show=!0})},register:function(){var e=this,t=this.form.username,a=this.form.name,n=this.form.email,r=this.form.password;console.log(t),this.$store.dispatch("register",{username:t,name:a,email:n,password:r}).then(function(){return e.$router.push("/")}).catch(function(e){return console.log(e)})}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper fadeInDown"},[a("div",{attrs:{id:"formContent"}},[a("div",{staticClass:"fadeIn first pt-3"}),e._v(" "),e.show?a("form",{on:{submit:e.onSubmit,reset:e.onReset}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.name,expression:"form.name"}],staticClass:"fadeIn second",attrs:{type:"text",id:"name",name:"name",placeholder:"Imię i nazwisko",required:""},domProps:{value:e.form.name},on:{input:function(t){t.target.composing||e.$set(e.form,"name",t.target.value)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.username,expression:"form.username"}],staticClass:"fadeIn second",attrs:{type:"text",id:"username",name:"username",placeholder:"Login",required:""},domProps:{value:e.form.username},on:{input:function(t){t.target.composing||e.$set(e.form,"username",t.target.value)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.email,expression:"form.email"}],staticClass:"fadeIn second",attrs:{type:"email",id:"email",name:"email",placeholder:"Adres email",required:""},domProps:{value:e.form.email},on:{input:function(t){t.target.composing||e.$set(e.form,"email",t.target.value)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password,expression:"form.password"}],staticClass:"fadeIn third",attrs:{type:"password",id:"password",name:"password",placeholder:"Hasło",required:""},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value)}}}),e._v(" "),a("input",{staticClass:"fadeIn fourth",attrs:{type:"submit",value:"Zarejestruj się"}})]):e._e()])])},staticRenderFns:[]};var y=a("VU/8")(k,_,!1,function(e){a("oSX7")},null,null).exports,b={data:function(){return{form:{username:"",password:""},show:!0,login_url:"https://calie-parking-backend.herokuapp.com/login"}},methods:{onSubmit:function(e){e.preventDefault(),this.login()},onReset:function(e){var t=this;e.preventDefault(),this.form.username="",this.form.password="",this.show=!1,this.$nextTick(function(){t.show=!0})},login:function(){var e=this,t=this.form.username,a=this.form.password;this.$store.dispatch("login",{username:t,password:a}).then(function(){return e.$router.push("/")}).catch(function(e){return console.log(e)})}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper fadeInDown"},[a("div",{attrs:{id:"formContent"}},[a("div",{staticClass:"fadeIn first pt-3"}),e._v(" "),e.show?a("form",{on:{submit:e.onSubmit,reset:e.onReset}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.username,expression:"form.username"}],staticClass:"fadeIn second",attrs:{type:"text",id:"login",name:"login",placeholder:"Login",required:""},domProps:{value:e.form.username},on:{input:function(t){t.target.composing||e.$set(e.form,"username",t.target.value)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password,expression:"form.password"}],staticClass:"fadeIn third",attrs:{type:"password",id:"password",name:"password",placeholder:"Hasło",required:""},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value)}}}),e._v(" "),a("input",{staticClass:"fadeIn fourth",attrs:{type:"submit",value:"Zaloguj się"}})]):e._e()])])},staticRenderFns:[]};var P=a("VU/8")(b,S,!1,function(e){a("Ji9J")},null,null).exports,I=a("Xxa5"),C=a.n(I),D=a("exGp"),z=a.n(D),x={waivedParkingDates:[],data:function(){return{username:this.$store.state.user.name,user_parking_space:this.$store.state.user.owned_parking_space,today:[new Date],selectedDay:null,daysToWaive:[],waivedParkingDates:[]}},computed:{getName:function(){return this.username.split(" ")[0]},getAttributes:function(){return[{dot:{color:"red"},dates:this.waivedParkingDates}]},convertDateToDay:function(){var e=[];return this.waivedParkingDates.map(function(t){return e.push(0==t.charAt(t.length-2)?parseInt(t.slice(-1)):parseInt(t.slice(-2)))}),e}},methods:{dayClicked:function(e){if(this.daysToWaive.includes(e.id)||this.waivedParkingDates.includes(e.id)){if(this.daysToWaive.includes(e.id)){var t=this.daysToWaive.indexOf(e.id);this.daysToWaive.splice(t,1)}}else this.daysToWaive.push(e.id);this.selectedDay=e},waiveParkingSpace:function(){var e=z()(C.a.mark(function e(t){var a,n=this;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a="https://calie-parking-backend.herokuapp.com/parking-space",h.a.post(a,{dates:t},{headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")}}).then(function(e){console.log("parking waived"),alert("Miejsce zwolnione"),n.$router.push("/")}).catch(function(e){alert("Jedna z dat już jest zwolniona")}),this.getWaivedParkingSpaces();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getWaivedParkingSpaces:function(){var e=z()(C.a.mark(function e(){var t,a=this;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t="https://calie-parking-backend.herokuapp.com/parking-space",h.a.get(t,{headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")}}).then(function(e){a.waivedParkingDates=e.data.dates}).catch(function(e){console.log(e)});case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},created:function(){var e=this;return z()(C.a.mark(function t(){return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.getWaivedParkingSpaces(),console.log(e.waivedParkingDates);case 2:case"end":return t.stop()}},t,e)}))()}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"grad"}},[a("div",[a("h5",[e._v("Cześć "),a("b",[e._v(e._s(this.getName))])]),e._v(" "),a("h4",[e._v("Tutaj możesz zwolnić swoje miejsce parkingowe nr: "),a("b",[e._v(e._s(e.user_parking_space))])])]),e._v(" "),a("vc-date-picker",{staticClass:"center_calendar",attrs:{attributes:e.getAttributes,mode:"multiple",color:"green","min-date":new Date,"disabled-dates":[{weekdays:[1,7]}],"is-inline":""},on:{dayclick:e.dayClicked},model:{value:e.today,callback:function(t){e.today=t},expression:"today"}}),e._v(" "),a("b-button",{staticClass:"mt-1 mb-2",attrs:{type:"submit",variant:"success"},on:{click:function(t){return e.waiveParkingSpace(e.daysToWaive)}}},[e._v("Zwolnij miejsce\n  ")])],1)},staticRenderFns:[]};var j=a("VU/8")(x,$,!1,function(e){a("J2kO")},null,null).exports,L={data:function(){return{username:this.$store.state.user.name,drawnLotteryId:-1,drawnParkingSpace:-1,drawnParkingSpaceDate:null,drawnParkingSpaceConfirmation:null,isParkingSpaceConfirmed:!1}},computed:{getParkingSpaceNumber:function(){return this.drawnParkingSpace},getDrawnLotteryDrawId:function(){return this.drawnLotteryId},getDrawnParkingSpaceDate:function(){console.log(this.drawnParkingSpaceDate.split(" "));var e=this.drawnParkingSpaceDate.split(" ");return e[0]+" "+e[1]+" "+e[2]+" "+e[3]},getUserName:function(){return this.$store.state.user.name.split(" ")[0]},checkIfParkingConfirmed:function(){return null!=this.drawnParkingSpaceConfirmation||!!this.isParkingSpaceConfirmed}},methods:{checkIfUserDrawnParkingSpace:function(){var e=z()(C.a.mark(function e(){var t,a=this;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://calie-parking-backend.herokuapp.com/lottery-draw",e.next=3,h.a.get(t,{headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")}}).then(function(e){a.drawnParkingSpace=e.data.parking_space_number,a.drawnLotteryId=e.data.lottery_draw_id,a.drawnParkingSpaceDate=e.data.date,a.drawnParkingSpaceConfirmation=e.data.confirmed_on,console.log(e)}).catch(function(e){console.log(e)});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),confirmDrawnParkingSpace:function(){var e=this;h.a.put("https://calie-parking-backend.herokuapp.com/lottery-draw/"+this.drawnLotteryId,{},{headers:{Authorization:"Bearer "+localStorage.getItem("auth_token")}}).then(function(t){alert("Miejsce zatwierdzone poprawnie"),e.isParkingSpaceConfirmed=!0,console.log(t)}).catch(function(e){alert("Niestety spóźniłeś się z rezerwacją"),console.log(e)})}},created:function(){this.checkIfUserDrawnParkingSpace()}},R={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("b-card",{staticClass:"border-top-0",staticStyle:{"background-image":"linear-gradient(#78EC6C, #57E86B)"}},[a("h1",{staticStyle:{color:"white"}},[e._v("Cześć "+e._s(this.getUserName))]),e._v(" "),a("a",{staticStyle:{"font-family":"Roboto","font-size":"20px",color:"white"}},[e._v("Losowanie obywa się o godzinie 15:00 oraz 18:00")]),a("br"),e._v(" "),a("a",{staticStyle:{"font-family":"Roboto","font-size":"20px",color:"white"}},[e._v("Jeśli poniżej pojawi się informacja, że wylosowałeś miejsce - potwierdź je!")]),e._v(" "),-1!=e.getDrawnLotteryDrawId?a("p",{staticStyle:{color:"green","margin-top":"1%"}},[e._v("Gratulacje, wylosowałeś miejsce nr:\n        "),a("b",[e._v(e._s(this.getParkingSpaceNumber))]),e._v(" w dniu "),a("b",[e._v(e._s(this.getDrawnParkingSpaceDate))])]):e._e(),e._v(" "),-1==e.getDrawnLotteryDrawId?a("p",{staticStyle:{color:"red","margin-top":"1%"}},[e._v("\n      Na ten moment, nie udało Ci się wylosować miejsca na jutro")]):e._e(),e._v(" "),e.checkIfParkingConfirmed||-1==e.getDrawnLotteryDrawId?e._e():a("p",{staticStyle:{"margin-top":"1%",color:"red"}},[e._v("\n      Musisz jeszcze zatwierdzić swoje miejsce!")]),e._v(" "),e.checkIfParkingConfirmed||-1==e.getDrawnLotteryDrawId?e._e():a("b-button",{staticClass:"mt-1",attrs:{type:"submit",variant:"success"},on:{click:e.confirmDrawnParkingSpace}},[e._v("Zatwierdź miejsce\n    ")]),e._v(" "),e.checkIfParkingConfirmed&&-1!=e.getDrawnLotteryDrawId?a("b-button",{staticClass:"mt-1",attrs:{disabled:""},on:{click:function(e){}}},[e._v("Zatwierdzono\n    ")]):e._e()],1)],1)},staticRenderFns:[]},N=a("VU/8")(L,R,!1,null,null,null).exports;n.default.use(d.a);var U=new d.a({mode:"history",routes:[{path:"/",name:"HelloWorld",component:w},{path:"/register",name:"Register",component:y},{path:"/login",name:"Login",component:P},{path:"/calendar",name:"Calendar",component:j,meta:{requiresAuth:!0}},{path:"/lottery",name:"Lottery",component:N}]});U.beforeEach(function(e,t,a){if(e.matched.some(function(e){return e.meta.requiresAuth})){if(f.getters.isLoggedIn&&f.getters.hasUserParking)return void a();a("/")}else a()});var T=U,A=a("Tqaz"),E=(a("Jmt5"),a("9M+g"),a("pLTS")),q=a.n(E);n.default.prototype.$http=h.a;var W=localStorage.getItem("auth_token");W&&(n.default.prototype.$http.defaults.headers.common.Authorization="Bearer "+W),n.default.use(A.a),n.default.use(q.a,{componentPrefix:"vc",screens:{tablet:"576px",laptop:"992px",desktop:"1200px"}}),n.default.config.productionTip=!1,new n.default({el:"#app",router:T,store:f,components:{App:l},template:"<App/>"})},P3JI:function(e,t){},ftB2:function(e,t){},"hRX+":function(e,t){},oSX7:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.848a868e8a000e20a413.js.map